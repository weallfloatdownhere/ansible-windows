phases:
  0_checks:
    checks:
      stats:
        - { path: /tmp/exists.txt, register: exists_reg,condition: 1==1 }
        - { path: /tmp/absent.txt, register: absent_reg }
  1_config:
    files:
      clean:
        - { path: /tmp/clean-me.txt, condition: 1<2 }
      downloads:
        - url: https://upload.wikimedia.org/wikipedia/commons/thumb/1/11/Test-Logo.svg/783px-Test-Logo.svg.png
          destination: /tmp/test-logo.png
          archive: { archive: True, destination: /tmp/test }
          force: True
          condition: 1<2
      imports:
        - source: templates/configuration.ini.j2
          destination: "/tmp/configtest.ini"
          owner: bin
          group: wheel
          mode: '0644'
          force: True
          template:
            vars:
              test: test
              test1: test1
              test2: test2
          condition: 1<2
  2_setup:
    system:
      services:
        - { name: spooler,start_mode: auto,state: started,condition: 1<2 }
      regedits:
        - name: Language Hotkey    
          path: HKCU:\Keyboard Layout\Toggle
          data: 3
          type: dword
          state: absent
          delete_key: yes
          condition: 1<2
  3_install:
    installation:
      reboot_after: False # Reboot at the end of this installation phase
      chocolatey:
        - { name: packagename,state: present,version: latest,condition: 1<2 }
      features:
        - name: Net-Framework-Features
          source: C:\Temp\iso\sources\sxs
          state: present
          reboot_if_needed: False
          include_sub_features: False
          include_management_tools: True
        - name: Net-Framework-Features-NoSource
          state: present
          reboot_if_needed: True
          include_sub_features: False
          include_management_tools: True
          condition: 1<2
      executables:
        - path: C:\temp\SQLEXPR_x64_ENU\SETUP.EXE
          product_id: Microsoft SQL Server SQL2019
          arguments:
            - SAPWD=VeryHardPassword
            - /ConfigurationFile=C:\temp\configuration.ini
          become: False
          become_method: runas
          become_user: "user"
          become_pass: "password"        
          condition: 1<2
  4_security:
    security:
      firewall:
        rules:
          - name: SMTP
            localport: 25
            action: allow
            direction: in
            protocol: tcp
            state: present
            enabled: yes
            program: any
            condition: 1<2